<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Linglear – Login Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      :root {
        --bg: #020617;
        --card-bg: rgba(15, 23, 42, 0.92);
        --card-border: rgba(56, 189, 248, 0.35);
        --accent: #38bdf8;
        --accent-soft: rgba(56, 189, 248, 0.2);
        --accent-strong: rgba(56, 189, 248, 0.9);
        --text-main: #e5e7eb;
        --text-muted: #9ca3af;
        --text-soft: #6b7280;
        --danger: #f97373;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        height: 100%;
        width: 100%;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "Segoe UI", sans-serif;
        background: radial-gradient(circle at top, #0f172a 0, #020617 50%, #020617 100%);
        color: var(--text-main);
        overflow: hidden;
      }

      body {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
      }

      .shell {
        position: relative;
        width: 100%;
        max-width: 720px;
        max-height: 520px;
      }

      .card {
        position: relative;
        margin: 0 auto;
        border-radius: 28px;
        background: radial-gradient(circle at top left, #0b1220 0, #020617 70%)
          border-box;
        padding: 36px 40px 28px 40px;
        border: 1px solid var(--card-border);
        box-shadow: 0 28px 80px rgba(15, 23, 42, 0.95);
        backdrop-filter: blur(26px) saturate(180%);
        -webkit-backdrop-filter: blur(26px) saturate(180%);
        overflow: hidden;
      }

      .card::before {
        content: "";
        position: absolute;
        inset: -120px;
        background: radial-gradient(
          circle at 0 0,
          rgba(56, 189, 248, 0.2),
          transparent 55%
        );
        opacity: 0.6;
        pointer-events: none;
      }

      .card-inner {
        position: relative;
        z-index: 1;
      }

      h1 {
        font-size: 28px;
        letter-spacing: 0.04em;
        margin-bottom: 4px;
      }

      .subtitle {
        font-size: 13px;
        line-height: 1.6;
        color: var(--text-soft);
        max-width: 460px;
        margin-bottom: 18px;
      }

      .cta-row {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 14px;
      }

      .btn-primary {
        appearance: none;
        border: none;
        border-radius: 999px;
        padding: 9px 20px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        color: #0b1120;
        background: radial-gradient(circle at 0 0, #38bdf8, #0ea5e9);
        box-shadow: 0 12px 32px rgba(56, 189, 248, 0.5);
        position: relative;
        overflow: hidden;
        transition: transform 0.15s ease-out, box-shadow 0.15s ease-out;
      }

      .btn-primary::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at 0 0, #e0f2fe, transparent 60%);
        opacity: 0;
        transition: opacity 0.2s ease-out;
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 16px 40px rgba(56, 189, 248, 0.66);
      }

      .btn-primary:hover::before {
        opacity: 0.35;
      }

      .btn-primary:active {
        transform: translateY(0);
        box-shadow: 0 8px 22px rgba(15, 23, 42, 0.9);
      }

      .status-line {
        font-size: 12px;
        color: var(--text-muted);
        min-height: 18px;
      }

      .status-line span {
        opacity: 0.72;
      }

      .error-text {
        font-size: 12px;
        margin-top: 4px;
        color: var(--danger);
        min-height: 16px;
      }

      .member-box {
        margin-top: 22px;
        border-radius: 18px;
        border: 1px solid var(--accent-soft);
        background: radial-gradient(
            circle at top right,
            rgba(56, 189, 248, 0.09),
            transparent 55%
          ),
          rgba(15, 23, 42, 0.9);
        padding: 14px 16px 14px 16px;
        position: relative;
        overflow: hidden;
      }

      .member-box::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
          circle at top left,
          rgba(129, 230, 217, 0.18),
          transparent 60%
        );
        mix-blend-mode: soft-light;
        opacity: 0;
        transition: opacity 0.4s ease-out;
      }

      .member-box.active::before {
        opacity: 0.8;
      }

      .member-title {
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 2px;
      }

      .member-body {
        font-size: 12px;
        color: var(--text-muted);
      }

      .member-body strong {
        color: #e5e7eb;
      }

      .public-box {
        margin-top: 14px;
        border-radius: 18px;
        border: 1px solid rgba(30, 64, 175, 0.7);
        background: rgba(15, 23, 42, 0.9);
        padding: 14px 16px;
      }

      .public-title {
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 2px;
      }

      .public-body {
        font-size: 12px;
        color: var(--text-muted);
      }

      .footer-note {
        margin-top: 18px;
        font-size: 11px;
        color: var(--text-soft);
      }

      .footer-note a {
        color: var(--accent-strong);
        text-decoration: none;
      }

      .footer-note a:hover {
        text-decoration: underline;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 2px 8px 2px 3px;
        border-radius: 999px;
        background: radial-gradient(circle at top left, #0ea5e9, #1e40af);
        color: #e5e7eb;
        font-size: 10px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        font-weight: 500;
        margin-bottom: 10px;
      }

      .pill-icon {
        width: 16px;
        height: 16px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 0, #e0f2fe, #0369a1);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.6);
      }

      .pill-icon span {
        font-size: 11px;
      }

      .pill-text {
        opacity: 0.9;
      }

      .members-only-label {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        color: var(--accent-strong);
        margin-bottom: 4px;
      }

      .hidden {
        display: none !important;
      }

      /* Subtle animated border glow */
      .card::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 28px;
        border: 1px solid transparent;
        background: conic-gradient(
              from 0deg,
              rgba(56, 189, 248, 0.35),
              rgba(59, 130, 246, 0.1),
              rgba(14, 165, 233, 0.3),
              rgba(56, 189, 248, 0.35)
            )
            border-box;
        mask: linear-gradient(#000 0 0) padding-box,
          linear-gradient(#000 0 0);
        mask-composite: xor;
        -webkit-mask-composite: xor;
        opacity: 0.6;
        mix-blend-mode: screen;
        animation: borderSpin 18s linear infinite;
        pointer-events: none;
      }

      @keyframes borderSpin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 640px) {
        body {
          padding: 16px;
        }

        .card {
          padding: 24px 20px 22px 20px;
          border-radius: 20px;
        }

        .card::after {
          border-radius: 20px;
        }

        h1 {
          font-size: 23px;
        }

        .subtitle {
          font-size: 12px;
        }
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <div class="card">
        <div class="card-inner">
          <div class="pill">
            <div class="pill-icon">
              <span>◎</span>
            </div>
            <span class="pill-text">Secure login preview</span>
          </div>

          <h1>Linglear</h1>
          <p class="subtitle">
            Basic Cognito login demo. A small “members-only” box appears only when
            you’re logged in.
          </p>

          <div class="cta-row">
            <button id="loginButton" class="btn-primary">Log in / Sign up</button>
            <span class="status-line" id="statusText">
              <span>Checking login status…</span>
            </span>
          </div>
          <p id="errorText" class="error-text"></p>

          <div id="membersBox" class="member-box hidden">
            <div class="members-only-label">Members only</div>
            <p class="member-title" id="memberTitle">Welcome back.</p>
            <p class="member-body" id="memberBody">
              This box is only visible when Cognito says you’re logged in.
              <br />
              <strong id="memberEmail"></strong>
            </p>
          </div>

          <div class="public-box">
            <p class="public-title">Public area</p>
            <p class="public-body">
              Everyone can see this, even if they’re not logged in.
            </p>
          </div>

          <p class="footer-note">
            Problems logging in? Make sure your Cognito callback URL is set to
            <a href="https://linglear.com/" target="_blank" rel="noopener"
              >https://linglear.com/</a
            >.
          </p>
        </div>
      </div>
    </div>

    <script>
      // === Linglear basic Cognito login (no Amplify) ===

      // Your Cognito config
      const region = "us-east-1";
      const userPoolId = "us-east-1_g7hqEe8iO";
      const clientId = "6lsk8r1jbfs2g0619pb6a01t9q";
      const cognitoDomain =
        "https://linglear-auth-1.auth.us-east-1.amazoncognito.com";
      const redirectUri = "https://linglear.com/";

      // Build Hosted UI login URL (implicit flow: access_token + id_token in hash)
      function buildLoginUrl() {
        const responseType = "token id_token";
        const scope = "openid email";
        const url =
          cognitoDomain +
          "/oauth2/authorize" +
          "?response_type=" +
          encodeURIComponent(responseType) +
          "&client_id=" +
          encodeURIComponent(clientId) +
          "&redirect_uri=" +
          encodeURIComponent(redirectUri) +
          "&scope=" +
          encodeURIComponent(scope) +
          "&identity_provider=" +
          encodeURIComponent("Google");
        return url;
      }

      function setStatus(message) {
        const el = document.getElementById("statusText");
        if (el) el.innerHTML = "<span>" + message + "</span>";
      }

      function setError(message) {
        const el = document.getElementById("errorText");
        if (el) el.textContent = message || "";
      }

      function setLoggedOutUI() {
        const box = document.getElementById("membersBox");
        if (box) box.classList.add("hidden");
        setStatus("You are not logged in.");
      }

      // Save tokens in localStorage for this demo
      function saveTokens(tokens) {
        try {
          localStorage.setItem("linglear_tokens", JSON.stringify(tokens));
        } catch (err) {
          console.warn("[LINGLEAR AUTH] Could not save tokens", err);
        }
      }

      function getSavedTokens() {
        try {
          const raw = localStorage.getItem("linglear_tokens");
          if (!raw) return null;
          return JSON.parse(raw);
        } catch (err) {
          console.warn("[LINGLEAR AUTH] Could not read tokens", err);
          return null;
        }
      }

      function clearTokens() {
        try {
          localStorage.removeItem("linglear_tokens");
        } catch (_) {}
      }

      // Decode JWT payload so we can read the email (optional)
      function decodeJwtPayload(token) {
        try {
          const payload = token.split(".")[1];
          const base64 = payload.replace(/-/g, "+").replace(/_/g, "/");
          const padded = base64.padEnd(
            base64.length + ((4 - (base64.length % 4)) % 4),
            "="
          );
          const json = atob(padded);
          return JSON.parse(json);
        } catch (err) {
          console.error("[LINGLEAR AUTH] Failed to decode id_token", err);
          return null;
        }
      }

      function setLoggedInUI(tokens) {
        const box = document.getElementById("membersBox");
        const emailEl = document.getElementById("memberEmail");
        const titleEl = document.getElementById("memberTitle");
        const bodyEl = document.getElementById("memberBody");

        if (!tokens || !tokens.id_token) {
          setLoggedOutUI();
          return;
        }

        const payload = decodeJwtPayload(tokens.id_token);
        const email = payload && payload.email ? payload.email : "(no email)";

        if (emailEl) emailEl.textContent = email;
        if (titleEl) titleEl.textContent = "Logged in as:";
        if (bodyEl)
          bodyEl.innerHTML =
            'You are now authenticated via Cognito.<br /><strong id="memberEmail">' +
            email +
            "</strong>";

        if (box) {
          box.classList.remove("hidden");
          box.classList.add("active");
        }

        setStatus("Logged in.");
      }

      function parseTokensFromHash() {
        if (!window.location.hash) return null;
        const hash = window.location.hash.replace(/^#/, "");
        const params = new URLSearchParams(hash);
        const idToken = params.get("id_token");
        const accessToken = params.get("access_token");
        const tokenType = params.get("token_type");
        const expiresIn = params.get("expires_in");

        if (!idToken && !accessToken) return null;

        return {
          id_token: idToken || null,
          access_token: accessToken || null,
          token_type: tokenType || null,
          expires_in: expiresIn ? Number(expiresIn) : null,
        };
      }

      function cleanUrl() {
        const url = window.location.origin + window.location.pathname;
        window.history.replaceState({}, document.title, url);
      }

      function handleAuthCallbackIfPresent() {
        try {
          const tokens = parseTokensFromHash();
          if (!tokens) return;

          // Clear the URL fragment to keep things clean
          cleanUrl();

          // Save tokens for later use
          saveTokens(tokens);

          // Update UI
          setLoggedInUI(tokens);
        } catch (err) {
          console.error("[LINGLEAR AUTH] Error handling auth callback:", err);
          setError("Error: Login failed. Please try again.");
        }
      }

      function checkExistingLogin() {
        const tokens = getSavedTokens();
        if (tokens && tokens.id_token) {
          setLoggedInUI(tokens);
        } else {
          setLoggedOutUI();
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        setStatus("Checking login status…");
        setError("");

        handleAuthCallbackIfPresent();
        checkExistingLogin();

        const loginBtn = document.getElementById("loginButton");
        if (loginBtn) {
          loginBtn.addEventListener("click", () => {
            setError("");
            setStatus("Redirecting to Cognito Hosted UI…");
            const url = buildLoginUrl();
            window.location.href = url;
          });
        }
      });
    </script>
  </body>
</html>
