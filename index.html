<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Linglear – Login Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Simple glassy styling just to not look awful -->
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0f172a, #020617);
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .card {
      backdrop-filter: blur(18px);
      background: rgba(15, 23, 42, 0.8);
      border-radius: 24px;
      padding: 24px 28px;
      max-width: 460px;
      width: 100%;
      box-shadow: 0 20px 50px rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(148, 163, 184, 0.3);
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.25), transparent 60%);
      opacity: 0.6;
      pointer-events: none;
    }
    h1 {
      font-size: 1.7rem;
      margin-bottom: 0.25rem;
    }
    p {
      margin-top: 0;
      color: #9ca3af;
      font-size: 0.95rem;
    }
    button {
      border-radius: 9999px;
      padding: 10px 18px;
      border: none;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 500;
      background: linear-gradient(135deg, #38bdf8, #0ea5e9);
      color: #0b1120;
      box-shadow: 0 6px 20px rgba(56, 189, 248, 0.45);
      transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.12s ease;
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 30px rgba(56, 189, 248, 0.55);
      opacity: 0.95;
    }
    button.secondary {
      background: transparent;
      color: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.7);
      box-shadow: none;
      margin-left: 8px;
    }
    #status {
      font-size: 0.85rem;
      color: #a5b4fc;
      margin-top: 8px;
    }
    .section {
      margin-top: 18px;
      padding: 14px 16px;
      border-radius: 16px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(30, 64, 175, 0.8);
    }
    .section h2 {
      margin: 0 0 6px;
      font-size: 1.05rem;
    }
    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 9999px;
      font-size: 0.7rem;
      background: rgba(56, 189, 248, 0.15);
      border: 1px solid rgba(56, 189, 248, 0.4);
      color: #bae6fd;
      margin-left: 6px;
    }
    a {
      color: #38bdf8;
      text-decoration: none;
      font-size: 0.85rem;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>

  <!-- AWS Amplify (Auth-only bundle) from CDN -->
  <script src="https://unpkg.com/aws-amplify@5.3.0/dist/aws-amplify.min.js"></script>
</head>
<body>
  <div class="card">
    <h1>Linglear</h1>
    <p>Basic Cognito login demo. A small “members-only” box appears only when you’re logged in.</p>

    <div>
      <button id="loginBtn">Log in / Sign up</button>
      <button id="logoutBtn" class="secondary" style="display:none;">Log out</button>
      <div id="status">Checking login status…</div>
    </div>

    <!-- PUBLIC AREA -->
    <div class="section" id="publicSection">
      <h2>Public area</h2>
      <p>Everyone can see this, even if they’re not logged in.</p>
    </div>

    <!-- MEMBER-ONLY AREA -->
    <div class="section" id="memberSection" style="display:none;">
      <h2>
        Member area
        <span class="tag">auth required</span>
      </h2>
      <p id="welcomeText">Welcome!</p>
      <p style="font-size:0.85rem; color:#9ca3af;">
        This is where you’ll eventually put your dashboard, library, SRS, or whatever you only want logged-in users to see.
      </p>
    </div>

    <div style="margin-top:10px; font-size:0.75rem; color:#6b7280;">
      Problems logging in? Make sure your Cognito callback URL is set to <code>https://linglear.com/</code>.
    </div>
  </div>

  <script>
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const statusEl = document.getElementById("status");
    const publicSection = document.getElementById("publicSection");
    const memberSection = document.getElementById("memberSection");
    const welcomeText = document.getElementById("welcomeText");

    // 1) Make sure Amplify actually loaded
    if (!window.aws_amplify) {
      statusEl.textContent = "Error: AWS Amplify script did not load.";
      console.error("aws_amplify global is missing. Check the <script src='https://unpkg.com/aws-amplify...'> tag.");
    } else {
      const { Amplify, Auth } = window.aws_amplify;

      // 2) YOUR COGNITO CONFIG (adjust if User Pool ID differs in console)
      const region = "us-east-1";
      const userPoolId = "us-east-1_rdnegqer1"; // <- check this matches your User pool ID
      const userPoolWebClientId = "5s39n3sffohs0nhf6i534f7d9h";
      const cognitoDomain = "https://us-east-1rdnegqer1.auth.us-east-1.amazoncognito.com";
      const redirectUrl = "https://linglear.com/"; // must match callback URL exactly

      // Basic sanity check
      if (!region || !userPoolId || !userPoolWebClientId || !cognitoDomain || !redirectUrl) {
        statusEl.textContent = "Config error: missing Cognito values.";
        console.error("Missing one or more Cognito config values.");
      }

      try {
        Amplify.configure({
          Auth: {
            region,
            userPoolId,
            userPoolWebClientId,
            oauth: {
              domain: cognitoDomain.replace(/^https?:\/\//, ""), // Amplify expects just the host
              scope: ["openid", "email", "profile"],
              redirectSignIn: redirectUrl,
              redirectSignOut: redirectUrl,
              responseType: "code", // Authorization Code + PKCE
            },
          },
        });
      } catch (e) {
        statusEl.textContent = "Error configuring Auth. See console.";
        console.error("Amplify.configure error:", e);
      }

      // 3) LOGIN / LOGOUT BUTTONS
      loginBtn.addEventListener("click", () => {
        Auth.federatedSignIn().catch((e) => {
          statusEl.textContent = "Error starting login. See console.";
          console.error("federatedSignIn error:", e);
        });
      });

      logoutBtn.addEventListener("click", async () => {
        try {
          await Auth.signOut();
          statusEl.textContent = "You are logged out.";
          memberSection.style.display = "none";
          publicSection.style.display = "block";
          logoutBtn.style.display = "none";
          loginBtn.style.display = "inline-block";
        } catch (err) {
          statusEl.textContent = "Error logging out. See console.";
          console.error("Error signing out:", err);
        }
      });

      // 4) CHECK AUTH STATUS ON LOAD
      async function checkAuth() {
        try {
          const user = await Auth.currentAuthenticatedUser();
          const username =
            user.username ||
            (user.attributes && user.attributes.email) ||
            "Linglear member";

          statusEl.textContent = "You are logged in.";
          welcomeText.textContent = `Welcome, ${username}!`;
          memberSection.style.display = "block";
          publicSection.style.display = "block";
          loginBtn.style.display = "none";
          logoutBtn.style.display = "inline-block";
        } catch (err) {
          console.log("No current user:", err && err.message);
          statusEl.textContent = "You are not logged in.";
          memberSection.style.display = "none";
          publicSection.style.display = "block";
          loginBtn.style.display = "inline-block";
          logoutBtn.style.display = "none";
        }
      }

      checkAuth().catch((e) => {
        statusEl.textContent = "Auth check failed. See console.";
        console.error("checkAuth error:", e);
      });
    }
  </script>
</body>
</html>
